<!DOCTYPE html>
<html lang="pl">
<head>
    <title>mObywatel</title>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="assets/app/main.css">
    <link rel="stylesheet" href="assets/app/id.css">
    <link rel="icon" type="image/x-icon" href="assets/app/images/AppIcon~phone~1792@2x~180x180.png">
    <link rel="apple-touch-icon" href="assets/app/images/AppIcon~phone~1792@2x~180x180.png">
    <link rel="shortcut icon" href="assets/app/images/AppIcon~phone~1792@2x~180x180.png">
</head>
<body>
    <button class="refresh_button" onclick="window.location.href = window.location.href.split('?')[0] + '?t=' + Date.now()" title="Force Refresh">↻</button>
    <div class="background" id="backgroundElement"></div>
    <div class="login_wrapper">
        <div class="top_grid">
            <img class="logo" src="assets/app/images/logo_large.png" alt="mObywatel">
            <p class="logo_text">mObywatel</p>
        </div>
        <div class="top_text">
            <p class="welcome"></p>
            <p class="login_text">Zaloguj się do aplikacji.</p>
        </div>
        <div class="password_box">
            <div class="password_grid">
                <p class="password_text">Hasło</p>
                <div class="input_holder">
                    <input class="password_input" type="password" autocomplete="off" id="passwordInput">
                    <div class="eye"></div>
                </div>
                <p class="forgot_password" id="forgotPasswordBtn">Nie pamiętasz hasła?</p>
            </div>
        </div>
        <div class="bottom">
            <p class="login" id="loginBtn">Zaloguj się</p>
            <div class="data">
                <img class="logo_other logo_white" src="assets/app/images/logoCoi@3x.png" alt="COI">
                <img class="logo_other logo_white" src="assets/app/images/mc@3x.png" alt="MC">
                <img class="logo_other logo_white" src="assets/app/images/kpo@3x.png" alt="KPO">
                <img class="logo_other" src="assets/app/images/nowykutaas123.jpg" alt="EU">
            </div>
            <p class="version">wersja 4.71.1 (2)</p>
        </div>
    </div>
    <div class="background_controls" id="backgroundControls">
        <div class="background_controls_grid">
            <button class="bg_control_btn" id="bgZoomOut">−</button>
            <button class="bg_control_btn" id="bgUp">↑</button>
            <button class="bg_control_btn" id="bgZoomIn">+</button>
            <button class="bg_control_btn" id="bgLeft">←</button>
            <div></div>
            <button class="bg_control_btn" id="bgRight">→</button>
            <div></div>
            <button class="bg_control_btn" id="bgDown">↓</button>
            <div></div>
        </div>
        <div class="bg_info_text" id="bgInfo"></div>
    </div>
    <script src="assets/app/auth.js"></script>
    <script src="assets/app/id.js"></script>
    <script src="assets/app/manifest.js"></script>
    <script>
        // Background position controls
        (function() {
            let bgX = 50;
            let bgY = 0;
            let bgSize = 150; // percentage
            
            function initBackgroundControls() {
                const bgElement = document.getElementById('backgroundElement');
                const controls = document.getElementById('backgroundControls');
                const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
                
                if (!bgElement || !controls || !forgotPasswordBtn) {
                    setTimeout(initBackgroundControls, 100);
                    return;
                }
                
                // Load saved position and size
                const savedX = localStorage.getItem('bgPosX');
                const savedY = localStorage.getItem('bgPosY');
                const savedSize = localStorage.getItem('bgSize');
                if (savedX !== null) bgX = parseFloat(savedX);
                if (savedY !== null) bgY = parseFloat(savedY);
                if (savedSize !== null) bgSize = parseFloat(savedSize);
                
                function updateBackgroundPosition() {
                    const pos = bgX + '% ' + bgY + '%';
                    console.log('Setting background position to:', pos, 'bgX:', bgX, 'bgY:', bgY);
                    bgElement.style.setProperty('background-position', pos, 'important');
                    // Force a reflow to ensure the style is applied
                    bgElement.offsetHeight;
                    localStorage.setItem('bgPosX', bgX);
                    localStorage.setItem('bgPosY', bgY);
                    updateInfoDisplay();
                }
                
                function updateBackgroundSize() {
                    bgElement.style.setProperty('background-size', bgSize + '% auto', 'important');
                    localStorage.setItem('bgSize', bgSize);
                    updateInfoDisplay();
                }
                
                function updateInfoDisplay() {
                    const infoElement = document.getElementById('bgInfo');
                    if (infoElement) {
                        const xPercent = Math.round(bgX);
                        const yPercent = Math.round(bgY);
                        const zoomPercent = Math.round(bgSize);
                        infoElement.innerHTML = `X: ${xPercent}%<br>Y: ${yPercent}%<br>Zoom: ${zoomPercent}%`;
                    }
                }
                
                function updateAll() {
                    updateBackgroundPosition();
                    updateBackgroundSize();
                    updateInfoDisplay();
                }
                
                updateAll();
                
                // Toggle controls
                forgotPasswordBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    controls.classList.toggle('active');
                };
                
                // Arrow buttons
                document.getElementById('bgUp').onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    bgY = bgY + 1;
                    updateBackgroundPosition();
                };
                
                document.getElementById('bgDown').onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    bgY = bgY - 1;
                    updateBackgroundPosition();
                };
                
                document.getElementById('bgLeft').onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    bgX = bgX - 1;
                    console.log('Left clicked, bgX changed to:', bgX);
                    updateBackgroundPosition();
                };
                
                document.getElementById('bgRight').onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    bgX = bgX + 1;
                    console.log('Right clicked, bgX changed to:', bgX);
                    updateBackgroundPosition();
                };
                
                // Zoom buttons
                document.getElementById('bgZoomIn').onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    bgSize = Math.min(300, bgSize + 5);
                    updateBackgroundSize();
                };
                
                document.getElementById('bgZoomOut').onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    bgSize = Math.max(100, bgSize - 5);
                    updateBackgroundSize();
                };
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initBackgroundControls);
            } else {
                initBackgroundControls();
            }
        })();
        
        // Password validation
        (function() {
            const CORRECT_PASSWORD = '777';
            
            function initLogin() {
                const loginBtn = document.getElementById('loginBtn');
                const passwordInput = document.getElementById('passwordInput');
                
                if (!loginBtn || !passwordInput) {
                    setTimeout(initLogin, 100);
                    return;
                }
                
                loginBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const enteredPassword = passwordInput.value;
                    
                    if (enteredPassword === CORRECT_PASSWORD) {
                        // Correct password - proceed to documents page
                        localStorage.setItem('hasUserData', 'true');
                        localStorage.setItem('sessionStartTime', Date.now());
                        window.location.href = 'documents.html';
                    } else {
                        // Wrong password - shake the input to indicate error
                        passwordInput.style.borderColor = '#ff4444';
                        passwordInput.style.animation = 'shake 0.3s ease';
                        setTimeout(function() {
                            passwordInput.style.animation = '';
                        }, 300);
                    }
                };
                
                // Reset border color when user starts typing
                passwordInput.addEventListener('input', function() {
                    passwordInput.style.borderColor = '';
                });
                
                // Allow Enter key to submit
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        loginBtn.click();
                    }
                });
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initLogin);
            } else {
                initLogin();
            }
        })();
    </script>
    <style>
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</body>
</html>
